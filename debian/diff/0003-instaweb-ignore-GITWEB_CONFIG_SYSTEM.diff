From 4b9dd270ea0fd795c31769c08cb03ea38ddb2b5e Mon Sep 17 00:00:00 2001
From: Jonathan Nieder <jrnieder@gmail.com>
Date: Fri, 3 Sep 2010 19:41:12 -0500
Subject: instaweb: ignore GITWEB_CONFIG_SYSTEM
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

The configuration in /etc/gitweb.conf might specify an arbitrary
filesystem layout, but instaweb wants a specific one.  So stop reading
/etc/gitweb.conf.  The caller can request to read settings from
gitweb.conf if they are really wanted by running

	GITWEB_CONFIG=/etc/gitweb.conf git instaweb

After v1.7.2-rc0~55^2~3 (git-instaweb: Configure it to work with new
gitweb structure, 2010-05-28), instaweb will provide its own
gitweb_config.perl, making this patch a no-op.  gitweb does not look
at the fallback /etc/gitweb.conf when supplied with a config file.

[jn: forward-ported to post-1.7.2 world.  Probably worth dropping.]

Reported-by: Uwe Kleine-KÃ¶nig <u.kleine-koenig@pengutronix.de>
Acked-by: Eric Wong <normalperson@yhbt.net>
Helped-by: Junio C Hamano <gitster@pobox.com>
Signed-off-by: Jonathan Nieder <jrnieder@gmail.com>
---
 git-instaweb.sh |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/git-instaweb.sh b/git-instaweb.sh
index 10fcebb..235e1b4 100755
--- a/git-instaweb.sh
+++ b/git-instaweb.sh
@@ -580,6 +580,7 @@ gitweb_conf() {
 our \$projectroot = "$(dirname "$fqgitdir")";
 our \$git_temp = "$fqgitdir/gitweb/tmp";
 our \$projects_list = \$projectroot;
+our \$GITWEB_CONFIG_SYSTEM = "";
 
 \$feature{'remote_heads'}{'default'} = [1];
 EOF
-- 
1.7.2.3.554.gc9b5c.dirty

